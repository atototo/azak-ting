# Epic: 주식 분석 시스템 뉴스 독립성 확보

**Epic ID**: CRAVENY-EPIC-001
**프로젝트**: 주식 분석 시스템 개편
**상태**: 승인 대기 → 진행 중 → 완료
**우선순위**: P0 (최우선)
**담당**: 백엔드/프론트엔드 개발팀
**기간**: 4주 (2025-11-18 ~ 2025-12-13)

---

## 📋 Epic 개요

### 비즈니스 가치
현재 주식 분석 시스템은 뉴스 발생에 전적으로 의존하여, **뉴스가 없는 종목은 사용자가 등록해도 분석이 전혀 수행되지 않는** 치명적인 문제가 있습니다. 이로 인해:
- 사용자가 등록한 종목이 "추적 중인 종목" 목록에 나타나지 않음
- 분석 커버리지 약 60% (Priority 1-2만 자동 리포트)
- 사용자 경험 및 제품 가치 근본적 훼손

### 목표
분석 시스템을 **뉴스 주도형**에서 **데이터 주도형**으로 전환하여:
1. ✅ **100% 분석 커버리지** 달성 (모든 활성 종목)
2. ⚡ **즉시 분석 제공** (등록 후 1분 이내)
3. 📊 **펀더멘털 분석 강화** (재무비율, 상품정보 추가)
4. 🎯 **시스템 단순화** (Priority 제거, is_active만 사용)

---

## 🎯 성공 지표

| 지표 | 현재 | 목표 | 측정 방법 |
|------|------|------|----------|
| 분석 커버리지 | ~60% | 100% | (리포트 보유 종목 / 활성 종목) × 100 |
| 첫 분석까지 시간 | 무한대 | < 1분 | 등록 후 첫 리포트까지 평균 시간 |
| 리포트 생성 빈도 | Priority 1-2만 3회/일 | 모든 활성 종목 3회/일 | 종목당 일일 리포트 수 |
| API 효율성 | 리포트당 0-5회 | 리포트당 0회 | 리포트 생성 시 KIS API 호출 수 |

---

## 📦 User Stories

이 Epic은 6개 Phase로 구성되며, 각 Phase별로 User Story가 생성됩니다:

### Phase 1: 데이터베이스 마이그레이션 (1주차)
- [US-001](stories/stock-analysis-redesign/US-001-db-migrations.md): DB 스키마 마이그레이션
  - product_info 테이블 생성
  - financial_ratios 테이블 생성
  - priority 컬럼 deprecated

### Phase 2: KIS API 통합 (1-2주차)
- [US-002](stories/stock-analysis-redesign/US-002-kis-api-integration.md): 신규 KIS API 메서드 구현
  - get_financial_ratios() 구현
  - get_product_info() 구현

### Phase 3: 데이터 수집 스케줄러 (2주차)
- [US-003](stories/stock-analysis-redesign/US-003-data-collection-scheduler.md): 주간 데이터 수집 스케줄러
  - 재무비율 수집 스케줄러 (일요일 새벽 2시)
  - 상품정보 수집 스케줄러 (일요일 새벽 1시)

### Phase 4: 분석 로직 재설계 (2-3주차)
- [US-004](stories/stock-analysis-redesign/US-004-analysis-logic-redesign.md): 뉴스 독립 분석 시스템
  - 종목 등록 즉시 분석 트리거
  - DB 기반 리포트 생성 (API 호출 0회)
  - Priority 필터 제거
  - 적응형 분석 프롬프트

### Phase 5: 프론트엔드 업데이트 (3주차)
- [US-005](stories/stock-analysis-redesign/US-005-frontend-updates.md): UI 개선
  - Priority 드롭다운 제거
  - 데이터 소스 배지 표시
  - 제한사항 섹션 추가

### Phase 6: 테스트 및 배포 (4주차)
- [US-006](stories/stock-analysis-redesign/US-006-testing-deployment.md): QA 및 프로덕션 배포
  - 통합 테스트
  - 성능 테스트
  - Blue-Green 배포

---

## 🏗️ 기술 아키텍처 변경

### Before (현재)
```
사용자 종목 등록
     ↓
stocks 테이블 (priority 1-5)
     ↓
뉴스 크롤러 (10분 간격)
     ↓
뉴스에 stock_code 있으면 → 분석 실행
     ↓
Priority 1-2만 하루 3회 리포트
```

### After (개편)
```
사용자 종목 등록
     ↓
즉시 초기 분석 실행 (KIS API 호출)
     ↓
정기 데이터 수집 (스케줄 기반)
  - 5분마다: 현재가, 호가
  - 매일: 투자자 수급, 일봉
  - 주 1회: 재무비율, 상품정보
     ↓
정기 리포트 생성 (하루 3회)
  - 대상: 모든 활성 종목
  - 데이터: DB 캐시만 (API 호출 0회)
```

---

## 🗓️ 타임라인

| 주차 | Phase | 마일스톤 | 담당 |
|------|-------|----------|------|
| 1주차 | Phase 1 | DB 마이그레이션 완료 | 백엔드 |
| 1-2주차 | Phase 2 | KIS API 통합 완료 | 백엔드 |
| 2주차 | Phase 3 | 스케줄러 가동 | 백엔드 |
| 2-3주차 | Phase 4 | 분석 재설계 완료 | 백엔드 |
| 3주차 | Phase 5 | 프론트엔드 업데이트 | 프론트엔드 |
| 4주차 | Phase 6 | 프로덕션 론칭 | DevOps + 전체 팀 |

---

## ⚠️ 리스크 및 의존성

### 주요 리스크
| 리스크 | 확률 | 영향도 | 완화 방안 |
|-------|------|--------|----------|
| 재무비율 API 실패 (모의투자 미지원) | 높음 | 높음 | 실전 계정 사용; 우아한 성능 저하 |
| DB 마이그레이션 데이터 손실 | 낮음 | 치명적 | 마이그레이션 전 전체 백업 |
| 성능 저하 (모든 종목 분석) | 중간 | 중간 | 배치 병렬화; 타임아웃 설정 |

### 의존성
- ✅ KIS API 접근 권한 (실전 계정)
- ✅ DB 백업 및 복원 프로세스
- ⏳ 프론트엔드 개발 리소스 (3주차)
- ⏳ DevOps 배포 준비 (4주차)

---

## 📚 관련 문서

- [PRD 문서](stock-analysis-redesign-prd.md) - 상세 요구사항 및 기술 사양
- [프로젝트 브리프](stock-analysis-redesign-brief.md) - 문제 분석 및 솔루션 개요
- [User Stories](stories/stock-analysis-redesign/) - 각 Phase별 상세 스토리

---

## ✅ Definition of Done

Epic이 완료되려면:
- [ ] 모든 6개 User Story가 완료 상태
- [ ] 분석 커버리지 95% 이상 달성
- [ ] 첫 분석까지 평균 시간 < 1분
- [ ] 모든 활성 종목이 하루 3회 리포트 수신
- [ ] 프로덕션 배포 완료 및 24시간 안정화
- [ ] 모니터링 대시보드에서 정상 지표 확인
- [ ] 롤백 계획 문서화 및 테스트 완료

---

**Epic 생성일**: 2025-11-17
**예상 완료일**: 2025-12-13
**실제 완료일**: TBD
**승인자**: Product Owner, Tech Lead
